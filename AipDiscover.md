## AipDiscover
AIPDiscover is a type of event that is recorded in the Office 365 Unified Audit Log. It represents a successful attempt to discover the Azure Information Protection (AIP) classification and labeling configuration for a tenant. This event is typically logged when an administrator or user with the appropriate permissions accesses the AIP configuration settings in the Azure Portal or uses the Azure Information Protection PowerShell cmdlets to view the configuration.

Azure Information Protection is a service that allows organizations to classify and label sensitive data, and apply policies to control how that data is accessed and shared. The AIPDiscover event can be useful for tracking and monitoring access to the AIP configuration, and ensuring that only authorized users are able to view or modify it.

Before connecting to Unified Audit Log - we need to connect with Exchange Online using PowerShell, you can use the following steps:

# Establishing remote Powershell session

This will establish a remote PowerShell session with Exchange Online.Once the connection is established, you can run Exchange Online cmdlets to manage your Exchange Online environment. 

Open a PowerShell window and run the Install-Module -Name ExchangeOnlineManagement command to install the Exchange Online Management module. This module provides cmdlets that can be used to manage Exchange Online.

1. Connect-IPPSSession is a PowerShell cmdlet used to create a remote connection to an Exchange Online PowerShell session.
2. Import-Module ExchangeOnlineManagement is a PowerShell cmdlet used to import the Exchange Online Management module into the current PowerShell session.

```powershell
# Import the PSSSession and Exchange Online cmdlets
Connect-IPPSSession
Import-Module ExchangeOnlineManagement
```

## Option 1 :- If you want to connect with a specific user. 

Command to prompt for a specific user for  your Exchange Online credentials.
```powershell
$UserCredential = Get-Credential 
```
Command to connect to Exchange Online using the provided credentials. 
```powershell
 Connect-ExchangeOnline -Credential $UserCredential -ShowProgress $true 
```
## Option 2 :- If you want to connect with credentials in the current session
Connect to Exchange Online using the credentials in the current session
```powershell
Connect-ExchangeOnline

# Extracting information from Search_unifiedauditlog   

The Search-UnifiedAuditLog cmdlet is a PowerShell command that can be used to search the Office 365 Unified Audit Log. The Unified Audit Log is a record of user and administrator activity in Office 365. It can be used to track events such as user login attempts, changes to user permissions, and the creation or deletion of Office 365 objects.

To extract the AIPDiscover event from the Unified Audit Log using PowerShell, you can use the following command:

```powershell
Search-UnifiedAuditLog -StartDate <start date> -EndDate <end date> -Operations AIPDiscover | Export-Csv -Path <output file>
```
This will search the Unified Audit Log for the specified date range and return any events with the operation type "AIPDiscover". The results will be exported to a CSV file at the specified path.

Note: This is just an example of how the Search-UnifiedAuditLog cmdlet can be used. You may need to adjust the command and specify additional parameters based on your specific requirements. For more information about the cmdlet and its parameters, you can refer to the Microsoft documentation or use the PowerShell Get-Help command.

Additional Powershell samples

```powershell
Search-UnifiedAuditLog -StartDate "9/1/22" -EndDate "10/19/22" -RecordType SharePointFileOperation
```

```powershell
Search-UnifiedAuditLog -Operations FileDeleted -StartDate 4-Nov-2022 -EndDate 5-Dec-2022 -ResultSize 2000
```



The following table contains information related to Azure Information Protection (AIP) scanner events.

| Event                 | Description                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
| :-------------------- | :---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| ClientIP              | The IP address of the device that was used when the activity was logged. The IP address is displayed in either an IPv4 or IPv6 address format. For some services, the value displayed in this property might be the IP address for a trusted application (for example, Office on the web apps) calling into the service on behalf of a user and not the IP address of the device used by person who performed the activity. Also, for Azure Active Directory-related events, the IP address isn't logged and the value for the ClientIP property is null. The IP address is displayed in either an IPv4 or IPv6 address format.                                                                                                                                                                                                                                                                 |
| CreationTime          | The date and time in Coordinated Universal Time (UTC) in ISO8601 format when the user performed the activity.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| DataState             | Describes the state of the data.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
| Id                    | GUID of the current record.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
| ObjectId              | File full path (URL). For SharePoint and OneDrive for Business activity, the full path name of the file or folder accessed by the user.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| Operation             | Describes type of access.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
| OrganizationId        | The GUID for your organization's Office 365 tenant. This value will always be the same for your organization, regardless of the Office 365 service in which it occurs.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
| RecordType            | The type of operation indicated by the record. See the AuditLogRecordType table for details on the types of audit log records. Here we only list the relevant MIP Record types. For more information, see the [full list of record types](/office/office-365-management-api/office-365-management-activity-api-schema#auditlogrecordtype).                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
| Scope                 | Was this event created by a hosted O365 service or an on-premises server? Possible values are online and onprem. Note that SharePoint is the only workload currently sending events from on-premises to O365.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| SensitiveInfoTypeData | Stores the datatype of the Sensitive Info type data.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| SensitivityLabelId    | The current MIP sensitivity label GUID. Use cmdlt Get-Label to get the full values of the GUID.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| UserId                | The User Principal Name (UPN) of the user who performed the action (specified in the Operation property) that resulted in the record being logged; for example, my_name@my_domain_name. <br><br>Note that records for activity performed by system accounts (such as SHAREPOINT\system or NT AUTHORITY\SYSTEM) are also included. In SharePoint, another value display in the UserId property is app@sharepoint. This indicates that the "user" who performed the activity was an application that has the necessary permissions in SharePoint to perform organization-wide actions (such as search a SharePoint site or OneDrive account) on behalf of a user, admin, or service. For more information, see the [app@sharepoint user in audit records](/microsoft-365/compliance/search-the-audit-log-in-security-and-compliance?view=o365-worldwide#the-appsharepoint-user-in-audit-records). |
| UserKey               | An alternative ID for the user identified in the UserId property. This property is populated with the passport unique ID (PUID) for events performed by users in SharePoint, OneDrive for Business, and Exchange.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
| UserType              | The type of user that performed the operation. See the UserType table for details on the types of users.</br>0 = Regular</br>1 = Reserved</br>2 = Admin </br>3 = DcAdmin</br>4 = Systeml</br>5 = Application</br>6 = ServicePrincipal</br>7 = CustomPolicy</br>8 = SystemPolicy                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| Version               | Version ID of the file in the operation.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
| Workload              | Stores the Office 365 service where the activity occurred.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
| ApplicationId         | The ID of the application performing the operation.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| ApplicationName       | Friendly name of the application performing the operation. Outlook (for email), OWA (for email), Word (for file), Excel (for file), PowerPoint (for file).                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
| ProcessName           | The relevant process name, eg. Outlook, msip.app, WinWord.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
| Platform              | Device platform (Win, OSX, Android, iOS).                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
| DeviceName            | The device on which the activity happened.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
| Location              | The location of the document with respect to the user's device. The possible values are unknown, localMedia, removableMedia, fileshare and cloud.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
| ProductVersion        | Version of the AIP client.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
| ProtectionType        | Protection type can be template or ad-hoc.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
| TemplateId            | TemplateID parameter to get a specific template. The Get-AipServiceTemplate cmdlet gets all existing or selected protection templates from Azure Information Protection.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
| IsProtected           | Whether protected: True/False                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| ProtectionOwner       | Rights Management owner in UPN format.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
